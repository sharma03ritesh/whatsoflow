import{r as d,j as e,H as ue}from"./app-BizxXqg7.js";import{P as xe,C as pe,N as be,T as fe,a as je,D as ye,b as Ne}from"./PipelineColumn-CTmgtk6J.js";import{c as H,B as j}from"./button-BQ_HaO7-.js";import{I as F}from"./input-V6jPku_u.js";import{B as O}from"./badge-DJri7UZe.js";import{X as B,a as ve,A as we,S as Se}from"./app-sidebar-layout-CaMs9F-P.js";import{L as v}from"./label-D43lO-9X.js";import{T as G}from"./textarea-C5GSch6G.js";import{S as W,a as Y,b as Z,c as ee,d as se}from"./select-CZ7g66Lg.js";import{D as te,b as ae,c as re,d as ne,e as le,f as oe}from"./dialog-CtonFf9y.js";import{P as ie}from"./style-H_FlYabE.js";import{L as Q}from"./loader-circle-qK_5H3YY.js";import{P as q}from"./plus-BCTyXobj.js";import{M as ke}from"./react-redux-6AeXlaNM.js";import"./index-DZiRmdSI.js";import"./index-3YIUB5mP.js";import"./loading-spinner-BXfFPKXA.js";import"./save-CU-1-yFF.js";import"./card-DySrz6MO.js";import"./index-BH0NSEIh.js";import"./app-logo-zSvHLsSz.js";import"./app-logo-icon-B8K9u0gq.js";import"./with-selector-BTF6SnSV.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Le=H("Pen",Ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Ee=H("Search",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]],De=H("Tags",Ie);function Pe({isOpen:n,onClose:S,onAddLead:T,columns:E}){const[i,y]=d.useState({name:"",phone:"",stage:void 0,tags:[],notes:"",email:"",lastMessage:""}),[m,w]=d.useState(!1),[I,k]=d.useState(""),[r,b]=d.useState({}),C=()=>{const a={};return i.name.trim()?i.name.length>255&&(a.name="Name must be less than 255 characters"):a.name="Name is required",i.phone.trim()?i.phone.length>20?a.phone="Phone number must be less than 20 characters":/^\+?[1-9]\d{1,14}$/.test(i.phone.replace(/\s/g,""))||(a.phone="Please enter a valid phone number"):a.phone="Phone number is required",(!i.stage||i.stage<1)&&(a.stage="Stage is required and must be valid"),i.notes&&i.notes.length>65535&&(a.notes="Notes must be less than 65535 characters"),i.tags.length===0?a.tags="At least one tag is required":i.tags.some(p=>p.length>50)&&(a.tags="Each tag must be less than 50 characters"),b(a),Object.keys(a).length===0},N=async a=>{if(a.preventDefault(),E.length===0){b({...r,stage:"No stages available. Please create a stage first."});return}if(C())try{w(!0),await T(i),y({name:"",phone:"",stage:1,tags:[],notes:"",email:"",lastMessage:""}),S()}catch(p){console.error("Error adding lead:",p)}finally{w(!1)}},h=(a,p)=>{y(f=>({...f,[a]:p}))},D=()=>{I.trim()&&!i.tags.includes(I.trim())&&(y(a=>({...a,tags:[...a.tags,I.trim()]})),k(""))},P=a=>{y(p=>({...p,tags:p.tags.filter(f=>f!==a)}))};return e.jsx(te,{open:n,onOpenChange:S,children:e.jsxs(ae,{className:"sm:max-w-[500px] max-h-[90vh] bg-white rounded-xl shadow-lg overflow-y-auto",children:[m&&e.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adding lead..."})]})}),e.jsxs(re,{className:"space-y-2",children:[e.jsx(ne,{className:"text-xl font-semibold text-black",children:"Add New Lead"}),e.jsx(le,{className:"text-gray-600",children:"Create a new lead and add it to your pipeline."})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",className:"text-sm font-medium text-black",children:"Name *"}),e.jsx(F,{id:"name",placeholder:"Enter lead name",value:i.name,onChange:a=>h("name",a.target.value),className:`h-11 bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 ${r.name?"border-red-500":"border-gray-200"}`,required:!0}),r.name&&e.jsx("p",{className:"text-sm text-red-500",children:r.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"phone",className:"text-sm font-medium text-black",children:"Phone *"}),e.jsx(ie,{country:"in",value:i.phone,onChange:a=>h("phone",a),inputClass:`!w-full !h-11 !text-sm bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 ${r.phone?"!border-red-500":"!border-gray-200"}`,buttonClass:"!bg-gray-200",containerClass:"mt-1",dropdownClass:"!text-black",placeholder:"Enter phone number",enableSearch:!0,searchPlaceholder:"Search country...",disableSearchIcon:!0}),r.phone&&e.jsx("p",{className:"text-sm text-red-500",children:r.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"stage",className:"text-sm font-medium text-black",children:"Stage *"}),e.jsxs(W,{value:i.stage?i.stage.toString():"",onValueChange:a=>h("stage",a),children:[e.jsx(Y,{className:`h-11 bg-white text-black border ${r.stage?"border-red-500":"border-gray-200"} focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20`,children:e.jsx(Z,{placeholder:"Select stage"})}),e.jsx(ee,{className:"bg-white border border-gray-200 rounded-md shadow-lg",children:E.map(a=>e.jsx(se,{value:a.id.toString(),className:"hover:bg-gray-200 cursor-pointer",children:a.title},a.id))})]}),r.stage&&e.jsx("p",{className:"text-sm text-red-500",children:r.stage})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",className:"text-sm font-medium text-black",children:"Notes"}),e.jsx(G,{id:"notes",placeholder:"Add notes about this lead...",value:i.notes,onChange:a=>h("notes",a.target.value),className:`min-h-[80px] bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 resize-none ${r.notes?"border-red-500":"border-gray-200"}`}),r.notes&&e.jsx("p",{className:"text-sm text-red-500",children:r.notes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-sm font-medium text-black",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[32px] p-2 rounded-lg border border-gray-200 bg-white",children:i.tags.map(a=>e.jsxs(O,{variant:"secondary",className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 border-blue-200",children:[a,e.jsx("button",{type:"button",onClick:()=>P(a),className:"ml-1 text-blue-500 hover:text-blue-700",children:e.jsx(B,{className:"h-3 w-3"})})]},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{placeholder:"Add a tag...",value:I,onChange:a=>k(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),D()),className:"h-10 bg-white border-gray-200 text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"}),e.jsx(j,{type:"button",onClick:D,size:"sm",variant:"outline",className:"h-10 px-3 border-gray-200 text-black hover:bg-gray-50",children:e.jsx(q,{className:"h-4 w-4"})})]})]})]}),e.jsxs(oe,{className:"gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:S,className:"h-11 px-6 border-gray-200 text-black hover:bg-gray-50",disabled:m,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:!i.name.trim()||!i.phone.trim()||i.tags.length===0,className:"h-11 px-6 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Lead"]})})]})]})]})})}function Ae({lead:n,isOpen:S,onClose:T,onUpdateLead:E,onDeleteLead:i,columns:y}){const[m,w]=d.useState(!1),[I,k]=d.useState(!1),[r,b]=d.useState({name:n?.name||"",phone:n?.phone||"",stage:n?.stage||1,tags:n?.tags||[],notes:n?.notes||""}),[C,N]=d.useState(""),[h,D]=d.useState({});d.useEffect(()=>{n&&b({name:n.name||"",phone:n.phone||"",stage:Number(n.stage)||1,tags:n.tags||[],notes:n.notes||""})},[n]);const P=()=>{const s={};r.name.trim()?r.name.length>255&&(s.name="Name must be less than 255 characters"):s.name="Name is required",r.phone&&r.phone.trim()&&(r.phone.length>20?s.phone="Phone number must be less than 20 characters":/^\+?[1-9]\d{1,14}$/.test(r.phone.replace(/\s/g,""))||(s.phone="Please enter a valid phone number"));const g=Number(r.stage);if((isNaN(g)||g<1)&&(s.stage="Stage is required and must be valid"),r.notes&&r.notes.length>65535&&(s.notes="Notes must be less than 65535 characters"),r.tags&&r.tags.length>0){for(const c of r.tags)if(typeof c=="string"){if(c.length>50){s.tags="Each tag must be less than 50 characters";break}}else if(c.name.length>50){s.tags="Each tag must be less than 50 characters";break}}return D(s),Object.keys(s).length===0},a=s=>{if(s.preventDefault(),!(!P()||!n))try{k(!0);const g={...n,name:r.name,phone:r.phone,stage:r.stage,notes:r.notes||null,tags:r.tags?.map(c=>typeof c=="string"?c:{id:c.id,name:c.name})||[]};E(g),w(!1),T()}catch(g){console.error("Error updating lead:",g)}finally{k(!1)}},p=()=>{n&&(i(n.id),T())},f=(s,g)=>{b(c=>({...c,[s]:g}))},M=()=>{if(!C.trim())return;const s=C.trim().toLowerCase();if(r.tags?.some(c=>typeof c=="string"?c.toLowerCase()===s:c.name.toLowerCase()===s)){N("");return}const g=C.trim();b(c=>({...c,tags:[...c.tags||[],g]})),N("")},A=s=>{b(g=>({...g,tags:(g.tags||[]).filter(c=>typeof c=="string"?c!==s:typeof s=="string"?c.name!==s:c.id!==s.id)}))},_=()=>{b({name:n?.name||"",phone:n?.phone||"",tags:n?.tags||[],stage:n?.stage||1,notes:n?.notes||""}),w(!1)};return n?e.jsx(te,{open:S,onOpenChange:s=>{s||_(),T()},children:e.jsxs(ae,{className:"sm:max-w-[500px] bg-white rounded-xl shadow-lg",children:[e.jsxs(re,{className:"space-y-2",children:[e.jsx(ne,{className:"text-xl font-semibold text-black",children:m?"Edit Lead":"Lead Details"}),e.jsx(le,{className:"text-gray-600",children:m?"Update the lead information below.":"View and manage lead details."})]}),e.jsx("div",{className:"space-y-6",children:m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",className:"text-sm font-medium text-black",children:"Name *"}),e.jsx(F,{id:"name",placeholder:"Enter lead name",value:r.name,onChange:s=>f("name",s.target.value),className:`h-11 bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 ${h.name&&m?"border-red-500":"border-gray-200"}`}),h.name&&m&&e.jsx("p",{className:"text-sm text-red-500",children:h.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"phone",className:"text-sm font-medium text-black",children:"Phone"}),e.jsx(ie,{country:"in",value:r.phone,onChange:s=>f("phone",s),inputClass:`!w-full !h-11 !text-sm bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 ${h.phone&&m?"!border-red-500":"!border-gray-200"}`,buttonClass:"!bg-gray-200",containerClass:"mt-1",dropdownClass:"!text-black",placeholder:"Enter phone number",enableSearch:!0,searchPlaceholder:"Search country...",disableSearchIcon:!0}),h.phone&&m&&e.jsx("p",{className:"text-sm text-red-500",children:h.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"stage",className:"text-sm font-medium text-black",children:"Stage"}),e.jsxs(W,{value:r.stage.toString(),onValueChange:s=>f("stage",s),children:[e.jsx(Y,{className:`h-11 bg-white text-black border ${h.stage?"border-red-500":"border-gray-200"} focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20`,children:e.jsx(Z,{placeholder:"Select stage",children:y.find(s=>s.id.toString()===r.stage.toString())?.title||"Select stage"})}),e.jsx(ee,{className:"bg-white border border-gray-200 rounded-md shadow-lg",children:y.map(s=>e.jsx(se,{"aria-selected":r.stage===s.id,value:s.id.toString(),className:"hover:bg-gray-200 cursor-pointer",children:s.title},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",className:"text-sm font-medium text-black",children:"Notes"}),e.jsx(G,{id:"notes",placeholder:"Add an initial message or note about this lead...",value:r.notes||"",onChange:s=>f("notes",s.target.value),className:`min-h-[80px] bg-white text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 resize-none ${h.notes&&m?"border-red-500":"border-gray-200"}`}),h.notes&&m&&e.jsx("p",{className:"text-sm text-red-500",children:h.notes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-sm font-medium text-black",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[32px] p-2 rounded-lg border border-gray-200 bg-white",children:r.tags?.map((s,g)=>{const c=typeof s=="string"?s:s.name,$=typeof s=="string"?g.toString():s.id;return e.jsxs(O,{className:"flex items-center gap-1 bg-blue-100 text-blue-800 hover:bg-blue-200",children:[c,e.jsx("button",{type:"button",onClick:z=>{z.stopPropagation(),A(s)},className:"ml-1 text-blue-500 hover:text-blue-700",children:e.jsx(B,{className:"h-3 w-3"})})]},$)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{placeholder:"Add a tag...",value:C,onChange:s=>N(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),M()),className:"h-10 bg-white border-gray-200 text-black placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"}),e.jsx(j,{type:"button",onClick:M,size:"sm",variant:"outline",className:"h-10 px-3 border-gray-200 text-black hover:bg-gray-50",children:e.jsx(q,{className:"h-4 w-4"})})]})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(ve,{className:"h-3 w-3 ml-2 text-muted-foreground flex-shrink-0"})," Name"]}),e.jsx("span",{className:"text-sm font-semibold text-black",children:n.name})]}),n.phone&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(xe,{className:"h-3 w-3 ml-2 text-muted-foreground flex-shrink-0"})," Phone"]}),e.jsx("span",{className:"text-sm font-mono text-black",children:n.phone})]}),n.lastMessage&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(ke,{className:"h-3 w-3 ml-2 text-muted-foreground flex-shrink-0"})," Last Message"]}),e.jsx("span",{className:"text-sm font-mono text-black overflow-hidden line-clamp-2",children:n.lastMessage}),e.jsxs("span",{className:"text-sm font-mono text-black overflow-hidden line-clamp-2",children:[e.jsx(pe,{className:"h-2 w-2"})," ",n.lastMessageTime]})]}),n.notes&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(be,{className:"h-3 w-3 ml-2 text-muted-foreground flex-shrink-0"})," Notes"]}),e.jsx("span",{className:"text-sm font-mono text-black overflow-hidden line-clamp-2",children:n.notes})]}),n.tags&&n.tags.length>0&&e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-600 mb-2",children:[e.jsx(De,{className:"h-4 w-4 ml-2 text-muted-foreground flex-shrink-0"})," Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map(s=>e.jsx(O,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:s.name},s.id))})]})]})})}),e.jsx(oe,{className:"gap-3 pt-4",children:m?e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:_,className:"h-11 px-6 border-gray-200 text-black hover:bg-gray-50",children:"Cancel"}),e.jsx(j,{type:"button",onClick:a,disabled:!r.name?.trim(),className:"h-11 px-6 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Changes"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{type:"button",variant:"outline",onClick:p,className:"h-11 px-6 border-red-200 text-red-600 hover:bg-red-50",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsxs(j,{type:"button",onClick:()=>w(!0),className:"h-11 px-6 bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Edit Lead"]})]})})]})}):null}function as(){const[n,S]=d.useState([]),[T,E]=d.useState([]),[i,y]=d.useState(""),[m,w]=d.useState([]),[I,k]=d.useState(!0),[r,b]=d.useState(null),[C,N]=d.useState(!1),[h,D]=d.useState({}),[P,a]=d.useState({}),[p,f]=d.useState(!1),[M,A]=d.useState(null),[_,s]=d.useState(!1),[g,c]=d.useState(0),$=t=>{if(!t)return;const l={...t,tags:Array.isArray(t.tags)?t.tags.map(o=>typeof o=="string"?{id:parseInt(o)||0,name:o}:{...o,id:typeof o.id=="string"?parseInt(o.id)||0:o.id}):[],lastMessage:t.lastMessage||void 0,lastMessageTime:t.lastMessageTime||void 0};A(l),s(!0)},z=()=>{c(t=>t+1)};d.useEffect(()=>{(async()=>{try{k(!0);const l=await fetch("/data/leads",{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!l.ok)throw new Error("Failed to fetch leads");const o=await l.json();S(o.columns),E(o.allTags),b(null)}catch(l){console.error(l),b("Failed to load leads."),E([])}finally{k(!1)}})()},[g]);const ce=async t=>{try{if(N(!0),!(await fetch("/data/leads",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:t.name,phone:t.phone,stage:t.stage,pipeline_column_id:t.pipeline_column_id,tags:t.tags||[],notes:t.notes,business_id:t.business_id})})).ok)throw new Error("Failed to add lead");c(o=>o+1)}finally{N(!1)}},de=async t=>{if(!t.id)return;const l=t.id.toString();try{if(D(u=>({...u,[l]:!0})),!(await fetch(`/data/leads/${l}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:t.name,phone:t.phone,stage:t.stage,pipeline_column_id:t.pipeline_column_id,tags:t.tags?.map(u=>u.name)||[],notes:t.notes,email:t.email,business_id:t.business_id})})).ok)throw new Error("Failed to update lead");A(null),s(!1)}finally{D(o=>{const u={...o};return delete u[l],u})}},me=async t=>{const l=t.toString();try{a(o=>({...o,[l]:!0})),await fetch(`/data/leads/${l}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}),c(o=>o+1),A(null),s(!1)}finally{a(o=>{const u={...o};return delete u[l],u})}},he=d.useMemo(()=>!i&&m.length===0?n:n.map(t=>({...t,leads:t.leads.filter(l=>{const o=i.toLowerCase(),u=!i||l.name?.toLowerCase()?.includes(o)||l.phone?.toLowerCase()?.includes(o)||l.notes?.toLowerCase()?.includes(o),L=m.length===0||l.tags&&l.tags.some(x=>m.includes(typeof x=="string"?x:x.name));return u&&L})})),[n,i,m]),ge=async t=>{const{destination:l,source:o,draggableId:u}=t;if(l&&!(l.droppableId===o.droppableId&&l.index===o.index)){S(L=>{const x=[...L],U=x.findIndex(X=>X.id===o.droppableId),K=x.findIndex(X=>X.id===l.droppableId);if(U===-1||K===-1)return L;const R={...x[U]},V={...x[K]},[J]=R.leads.splice(o.index,1);return J.pipeline_column_id=l.droppableId,V.leads.splice(l.index,0,J),x[U]=R,x[K]=V,x});try{N(!0),await fetch(`/data/leads/${u.toString()}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({pipeline_column_id:l.droppableId})}),c(L=>L+1)}catch(L){console.error(L),c(x=>x+1)}finally{N(!1)}}};return e.jsxs(we,{breadcrumbs:[{title:"Leads",href:"/leads"}],children:[e.jsx(ue,{title:"Leads"}),e.jsxs("div",{className:"space-y-8 p-6 md:p-8 lg:p-10 bg-gradient-to-br from-background via-background to-muted/20 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Leads Pipeline"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Manage and track your leads"})]}),e.jsxs(j,{size:"lg",variant:"outline",onClick:()=>f(!0),children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Add Lead"]})]}),r&&e.jsx("div",{className:"bg-red-50 border border-red-200 p-4 text-red-800 rounded-md",children:r}),e.jsx(je,{onSave:z,children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Pipeline Settings"]})}),e.jsxs("div",{className:"bg-card rounded-xl p-6 border shadow-sm",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ee,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search leads...",value:i,onChange:t=>y(t.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.map(t=>e.jsx(O,{variant:m.includes(t)?"selected":"outline",onClick:()=>w(l=>l.includes(t)?l.filter(o=>o!==t):[...l,t]),className:"cursor-pointer",children:t},t)),(i||m.length>0)&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{y(""),w([])},children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Clear"]})]})]}),I?e.jsx("div",{className:"text-center py-12",children:"Loading..."}):e.jsx(ye,{onDragEnd:ge,children:e.jsx("div",{className:"rounded-xl p-6 border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-6 min-w-max",children:he.map(t=>e.jsx(Ne,{column:t,onLeadClick:$,updatingLeads:h,deletingLeads:P},t.id))})})})}),C&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-primary text-primary-foreground px-4 py-2 rounded-md shadow-lg",children:"Updating..."}),e.jsx(Pe,{isOpen:p,onClose:()=>f(!1),onAddLead:ce,columns:n}),e.jsx(Ae,{lead:M,isOpen:_,onClose:()=>s(!1),onUpdateLead:de,onDeleteLead:me,columns:n})]})]})}export{as as default};
