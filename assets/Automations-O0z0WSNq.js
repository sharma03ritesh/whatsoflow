import{r,j as e,H as M}from"./app-BizxXqg7.js";import{B as j}from"./button-BQ_HaO7-.js";import{I as x}from"./input-V6jPku_u.js";import{B as V}from"./badge-DJri7UZe.js";import{D as X,a as G,b as J,c as Q,d as $,e as W,f as z}from"./dialog-CtonFf9y.js";import{C as Y,a as Z,b as ee,c as te}from"./card-DySrz6MO.js";import{S as ae}from"./switch-JSzLyKdu.js";import{L as d}from"./label-D43lO-9X.js";import{S,a as w,b as C,c as A,d as T}from"./select-CZ7g66Lg.js";import{A as se}from"./app-sidebar-layout-CaMs9F-P.js";import{P as ne}from"./plus-BCTyXobj.js";import{L as re}from"./loader-circle-qK_5H3YY.js";import"./loading-spinner-BXfFPKXA.js";import"./index-DZiRmdSI.js";import"./index-3YIUB5mP.js";import"./index-BH0NSEIh.js";import"./app-logo-zSvHLsSz.js";import"./app-logo-icon-B8K9u0gq.js";const F=[{value:"new_lead",label:"New Lead Created"},{value:"stage_change",label:"Stage Change"},{value:"keyword",label:"Keyword Match"},{value:"timed",label:"Timed"}],D=[{value:"send_message",label:"Send Message"},{value:"update_stage",label:"Update Stage"},{value:"add_tag",label:"Add Tag"}];function Fe(){const[g,u]=r.useState([]),[E,_]=r.useState(!0),[L,ie]=r.useState(null),[y,i]=r.useState(null),[k,f]=r.useState(!1),[v,N]=r.useState(!1),[oe,h]=r.useState({}),[ce,le]=r.useState({}),[I,de]=r.useState(""),[b,O]=r.useState(null),[a,o]=r.useState({name:"",trigger_type:"",trigger_value:"",action_type:"",action_config:{},delay_seconds:0,is_active:!0});r.useEffect(()=>{P()},[]);const P=async()=>{try{_(!0),i(null);const t=await fetch("/data/automations",{headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!t.ok)throw new Error("Failed to fetch automations");const n=await t.json();u(n.automations||[])}catch(t){console.error("Error fetching automations:",t),i(t.message||"Failed to load automations")}finally{_(!1)}};g.filter(t=>t.name.toLowerCase().includes(I.toLowerCase()));const U=async()=>{if(!a.name||!a.trigger_type||!a.action_type){i("Please fill in all required fields");return}if(a.action_type==="send_message"&&!a.action_config.message){i("Please enter a message for the send message action");return}if(a.action_type==="update_stage"&&!a.action_config.stage){i("Please enter a stage for the update stage action");return}if(a.action_type==="add_tag"&&!a.action_config.tag){i("Please enter a tag for the add tag action");return}const t=!!b?.id,n=b?.id,p=t?"PUT":"POST",c=t?`/data/automations/${n}`:"/data/automations";try{t?h(l=>({...l,[n]:!0})):N(!0),i(null);const s=await fetch(c,{method:p,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(a)});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.message||"Failed to save automation")}const m=await s.json();u(t?g.map(l=>l.id===n?{...l,...m.automation}:l):[m.automation,...g]),f(!1),R()}catch(s){console.error("Error saving automation:",s),i(s.message||"Failed to save automation")}finally{t?h(s=>{const m={...s};return delete m[n],m}):N(!1)}},R=()=>{o({name:"",trigger_type:"",trigger_value:"",action_type:"",action_config:{},delay_seconds:0,is_active:!0}),O(null)},q=async t=>{if(!t.id)return;const n=t.id.toString(),p=!t.is_active;try{if(h(s=>({...s,[n]:!0})),!(await fetch(`/data/automations/${n}/status`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({is_active:p})})).ok)throw new Error("Failed to update automation status");u(g.map(s=>s.id===t.id?{...s,is_active:p}:s))}catch(c){console.error("Error toggling automation status:",c),i(c.message||"Failed to update automation status")}finally{h(c=>{const s={...c};return delete s[n],s})}},B=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=t=>F.find(n=>n.value===t)?.label||t,K=t=>D.find(n=>n.value===t)?.label||t;return e.jsxs(se,{breadcrumbs:[{title:"Automations",href:"/automations"}],children:[e.jsx(M,{title:"Automations"}),e.jsxs("div",{className:"space-y-6 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Automations"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your automated workflows and triggers"})]}),e.jsxs(X,{open:k,onOpenChange:f,children:[e.jsx(G,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Create Automation"]})}),e.jsxs(J,{className:"bg-white text-foreground sm:max-w-[600px]",children:[e.jsxs(Q,{children:[e.jsx($,{children:"Create New Automation"}),e.jsx(W,{children:"Set up a new automation workflow with triggers and actions"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Name *"}),e.jsx(x,{id:"name",placeholder:"e.g., Welcome New Leads",value:a.name,onChange:t=>o({...a,name:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"trigger_type",children:"Trigger *"}),e.jsxs(S,{value:a.trigger_type,onValueChange:t=>o({...a,trigger_type:t}),children:[e.jsx(w,{id:"trigger_type",className:"bg-white text-foreground",children:e.jsx(C,{placeholder:"Select a trigger"})}),e.jsx(A,{className:"bg-white text-foreground",children:F.map(t=>e.jsx(T,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"action_type",children:"Action *"}),e.jsxs(S,{value:a.action_type,onValueChange:t=>o({...a,action_type:t}),children:[e.jsx(w,{id:"action_type",className:"bg-white text-foreground",children:e.jsx(C,{placeholder:"Select an action"})}),e.jsx(A,{className:"bg-white text-foreground",children:D.map(t=>e.jsx(T,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"delay_seconds",children:"Delay (seconds)"}),e.jsx(x,{id:"delay_seconds",type:"number",min:"0",placeholder:"0",value:a.delay_seconds,onChange:t=>o({...a,delay_seconds:parseInt(t.target.value)||0})})]}),a.action_type==="send_message"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"message",children:"Message"}),e.jsx("textarea",{id:"message",className:"w-full p-2 border rounded-md",rows:3,placeholder:"Enter your message here...",value:a.action_config.message||"",onChange:t=>o({...a,action_config:{...a.action_config,message:t.target.value}})})]}),a.action_type==="update_stage"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"stage",children:"Stage"}),e.jsx(x,{id:"stage",placeholder:"Enter stage name...",value:a.action_config.stage||"",onChange:t=>o({...a,action_config:{...a.action_config,stage:t.target.value}})})]}),a.action_type==="add_tag"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"tag",children:"Tag"}),e.jsx(x,{id:"tag",placeholder:"Enter tag name...",value:a.action_config.tag||"",onChange:t=>o({...a,action_config:{...a.action_config,tag:t.target.value}})})]})]}),e.jsxs(z,{children:[e.jsx(j,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(j,{onClick:U,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create"})]})]})]})]}),y&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-800 border border-red-200",children:y}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Automations List"})}),e.jsx(te,{children:E?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading automations..."}):g.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No automations found. Create your first automation to get started."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:"Name"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Trigger"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Actions"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Created At"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:t.name}),e.jsx("td",{className:"p-4",children:H(t.trigger_type)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(V,{variant:"secondary",className:"text-xs",children:K(t.action_type)}),t.action_config&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.action_type==="send_message"&&t.action_config.message&&e.jsxs("span",{className:"truncate block max-w-[200px]",children:[t.action_config.message.substring(0,50),"..."]}),t.action_type==="update_stage"&&t.action_config.stage&&e.jsxs("span",{children:["Stage: ",t.action_config.stage]}),t.action_type==="add_tag"&&t.action_config.tag&&e.jsxs("span",{children:["Tag: ",t.action_config.tag]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{checked:t.is_active,onCheckedChange:()=>q(t),disabled:L===t.id}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.is_active?"Active":"Inactive"})]})}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:B(t.created_at)})]},t.id))})]})})})]})]})]})}export{Fe as default};
