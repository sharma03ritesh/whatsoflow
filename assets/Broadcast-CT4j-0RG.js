import{r as l,j as e}from"./app-BizxXqg7.js";import{A as E,X as _}from"./app-sidebar-layout-CaMs9F-P.js";import{c as o,B as h}from"./button-BQ_HaO7-.js";import{C as p,a as x,b as u,c as g}from"./card-DySrz6MO.js";import{I as $}from"./input-V6jPku_u.js";import{T as H}from"./textarea-C5GSch6G.js";import{L as c}from"./label-D43lO-9X.js";import{S as O,a as q,b as R,c as G,d as V}from"./select-CZ7g66Lg.js";import{B as J}from"./badge-DJri7UZe.js";import{D as W,b as Q,c as X,d as Y,e as Z}from"./dialog-CtonFf9y.js";import{L as T}from"./loader-circle-qK_5H3YY.js";import{E as K}from"./eye-DOQScLsQ.js";import"./loading-spinner-BXfFPKXA.js";import"./index-DZiRmdSI.js";import"./index-3YIUB5mP.js";import"./index-BH0NSEIh.js";import"./app-logo-zSvHLsSz.js";import"./app-logo-icon-B8K9u0gq.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],j=o("File",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],se=o("Image",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ie=o("Send",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],le=o("Upload",re),f=[{value:"all",label:"All Leads"},{value:"new",label:"New Leads"},{value:"contacted",label:"Contacted Leads"},{value:"qualified",label:"Qualified Leads"},{value:"custom",label:"Custom Segment"}];function Ce(){const[s,d]=l.useState({campaignName:"",audienceSegment:"",message:"",mediaFile:null,mediaUrl:null,mediaType:null}),[N,U]=l.useState([]),[D,y]=l.useState(!0),[w,v]=l.useState(!1),[m,b]=l.useState(!1),[S,r]=l.useState(null),[A,C]=l.useState(!1);l.useEffect(()=>{F()},[]);const F=async()=>{try{y(!0),r(null);let a;if(window.axios)a=await window.axios.get("/api/broadcast/history",{headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`}});else{const t=await fetch("/api/broadcast/history",{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(!t.ok)throw new Error("Failed to fetch broadcast history");a={data:await t.json()}}U(a.data||[])}catch(a){r(a.response?.data?.message||a.message||"Failed to load broadcast history")}finally{y(!1)}},B=async a=>{try{b(!0),r(null);const t=new FormData;t.append("file",a);let i;if(window.axios)i=await window.axios.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});else{const n=await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:t});if(!n.ok)throw new Error("Failed to upload file");i={data:await n.json()}}const k=a.type.startsWith("image/")?"image":"document";d(n=>({...n,mediaFile:a,mediaUrl:i.data.url||i.data.path,mediaType:k}))}catch(t){r(t.response?.data?.message||t.message||"Failed to upload file")}finally{b(!1)}},I=a=>{const t=a.target.files?.[0];if(t){if(t.size>10*1024*1024){r("File size must be less than 10MB");return}B(t)}},L=()=>{d(a=>({...a,mediaFile:null,mediaUrl:null,mediaType:null}))},P=async()=>{if(!s.campaignName||!s.audienceSegment||!s.message){r("Please fill in all required fields");return}try{v(!0),r(null);const a={campaignName:s.campaignName,audienceSegment:s.audienceSegment,message:s.message,mediaUrl:s.mediaUrl,mediaType:s.mediaType};let t;if(window.axios)t=await window.axios.post("/api/broadcast/send",a,{headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`}});else{const i=await fetch("/api/broadcast/send",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify(a)});if(!i.ok)throw{response:{data:await i.json().catch(()=>({}))},status:i.status};t={data:await i.json()}}d({campaignName:"",audienceSegment:"",message:"",mediaFile:null,mediaUrl:null,mediaType:null}),F()}catch(a){r(a.response?.data?.message||a.message||"Failed to send broadcast")}finally{v(!1)}},M=a=>{const t={completed:"default",sending:"secondary",pending:"outline",failed:"destructive"};return e.jsx(J,{variant:t[a]||"outline",children:a.charAt(0).toUpperCase()+a.slice(1)})},z=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(E,{breadcrumbs:[{title:"Broadcast",href:"/broadcast"}],children:e.jsxs("div",{className:"space-y-6 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Broadcast"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Send bulk WhatsApp messages to your audience"})]}),S&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-800 border border-red-200",children:S}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(u,{children:"Create Broadcast"})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"campaignName",children:"Campaign Name *"}),e.jsx($,{id:"campaignName",placeholder:"e.g., New Product Launch",value:s.campaignName,onChange:a=>d({...s,campaignName:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"audienceSegment",children:"Audience Segment *"}),e.jsxs(O,{value:s.audienceSegment,onValueChange:a=>d({...s,audienceSegment:a}),children:[e.jsx(q,{id:"audienceSegment",children:e.jsx(R,{placeholder:"Select audience segment"})}),e.jsx(G,{children:f.map(a=>e.jsx(V,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"message",children:"Message *"}),e.jsx(H,{id:"message",placeholder:"Type your message here...",value:s.message,onChange:a=>d({...s,message:a.target.value}),rows:6,className:"resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.message.length," characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Media (Optional)"}),s.mediaUrl?e.jsxs("div",{className:"border rounded-md p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.mediaType==="image"?e.jsx(se,{className:"h-4 w-4"}):e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:s.mediaFile?.name||"Media"})]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:L,children:e.jsx(_,{className:"h-4 w-4"})})]}),s.mediaType==="image"&&e.jsx("img",{src:s.mediaUrl,alt:"Preview",className:"max-w-full h-32 object-contain rounded"})]}):e.jsx("div",{className:"border-2 border-dashed rounded-md p-4",children:e.jsxs("label",{className:"flex flex-col items-center cursor-pointer",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:m?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4"}),"Click to upload or drag and drop"]})}),e.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:I,className:"hidden",disabled:m}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"PNG, JPG, PDF up to 10MB"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>C(!0),disabled:!s.message,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Preview"]}),e.jsx(h,{onClick:P,disabled:w||m,className:"flex-1",children:w?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Send Broadcast"]})})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(u,{children:"Message Preview"})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-3",children:[s.mediaUrl&&s.mediaType==="image"&&e.jsx("img",{src:s.mediaUrl,alt:"Preview",className:"w-full rounded"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message||"Your message will appear here..."}),s.mediaUrl&&s.mediaType==="document"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:s.mediaFile?.name||"Document"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:e.jsxs("p",{children:["Audience:"," ",f.find(a=>a.value===s.audienceSegment)?.label||"Not selected"]})})]})})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(u,{children:"Broadcast History"})}),e.jsx(g,{children:D?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading history..."}):N.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No broadcast history yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:"Campaign Name"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Sent"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Delivered"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Created At"})]})}),e.jsx("tbody",{children:N.map(a=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:a.campaignName}),e.jsx("td",{className:"p-4",children:a.sent}),e.jsx("td",{className:"p-4",children:a.delivered}),e.jsx("td",{className:"p-4",children:M(a.status)}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:z(a.createdAt)})]},a.id))})]})})})]}),e.jsx(W,{open:A,onOpenChange:C,children:e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Message Preview"}),e.jsx(Z,{children:"This is how your message will appear to recipients"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-3",children:[s.mediaUrl&&s.mediaType==="image"&&e.jsx("img",{src:s.mediaUrl,alt:"Preview",className:"w-full rounded"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message||"No message"}),s.mediaUrl&&s.mediaType==="document"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:s.mediaFile?.name||"Document"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Campaign:"})," ",s.campaignName||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Audience:"})," ",f.find(a=>a.value===s.audienceSegment)?.label||"Not selected"]})]})]})]})})]})})}export{Ce as default};
